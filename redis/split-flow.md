## Background
原来做项目时，用到过redis, 它的性能以及API的设计非常友好。最近的项目中，我们为了加快加载的速度，事先将数据导入redis, 这样运行时，加载rdb文件就会快很多。为了方便算法training,需要加载不同的rdb文件，如果放在一个rdb文件中，加载速度会变慢，同时，key search的空间变大，也会影响效率。

搜索了redis的API，都没有提供reload rdb的接口。估计是在设计时，都觉得这是一个伪需求吧，如果需要重新load rdb, 那直接重启，再加载不就好了吗？关键是我们其它的模块也用到了这个redis, 如果直接重启，加载rdb, 都导致引入别的重连逻辑，造成不必要的麻烦。

## 方案1：线上导入数据
最简单的方法，就是直接通过redis的接口导入数据。但是由于我们的数据有近100万条，导入的时候需要10几秒的时间; 同样的数据，直接加载rdb时，只需要300ms左右。性能上差别太大，决定放弃此方案。

## 方案2：多个redis server 进行数据分流
由于只想更换数据部分，其它控制命令，比如利用redis的pub/sub进行进程间通讯，不想被中断。那为什么不直接启用两个redis server? 同时启用两个redis server, 还使command 之间不会出现block, 因为毕竟redis为了保证一致性，一个时间只会有一个命令或者脚本执行。

这个方案成功解决了我们的问题。同时，同事提到，这个方法在集群中很常见。不同作用的服务，进行分离，放在不同的service上。好像很显而易见的样子。如果是大型的服务，确实是一个很容易想到的方法。不过数据流和控制流的分离，确实是很多service的一个常见设计。数据流和控制流的特性不同，如果数据很大，可能会影响到控制流的可达性和延时性，所以他们往往会通过不同的channel进行传输，使两者独立，互不影响。读研的时候，看openflow的设计，正是如此。只有当实践中真正体会到，才会更加变成自己的东西。
